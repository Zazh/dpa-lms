{% extends "backoffice/base.html" %}

{% block title %}–í—ã–ø—É—Å–∫–Ω–∏–∫–∏ - Backoffice{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">–í—ã–ø—É—Å–∫–Ω–∏–∫–∏</h1>
    <p class="mt-2 text-sm text-gray-600">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø—É—Å–∫–æ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏</p>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="grid grid-cols-1 gap-5 sm:grid-cols-3 mb-8">
    <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="rounded-md bg-yellow-50 p-3">
                        <span class="text-2xl">‚è≥</span>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">–û–∂–∏–¥–∞—é—Ç –≤—ã–ø—É—Å–∫–∞</dt>
                        <dd class="text-3xl font-semibold text-gray-900">{{ stats.pending }}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    
    <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="rounded-md bg-green-50 p-3">
                        <span class="text-2xl">üéì</span>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">–í—ã–ø—É—â–µ–Ω—ã</dt>
                        <dd class="text-3xl font-semibold text-gray-900">{{ stats.graduated }}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    
    <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="rounded-md bg-red-50 p-3">
                        <span class="text-2xl">‚ùå</span>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">–û—Ç–∫–ª–æ–Ω–µ–Ω—ã</dt>
                        <dd class="text-3xl font-semibold text-gray-900">{{ stats.rejected }}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="bg-white shadow rounded-lg mb-6">
    <div class="px-4 py-5 sm:p-6">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <!-- –°—Ç–∞—Ç—É—Å -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">–°—Ç–∞—Ç—É—Å</label>
                <select name="status" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <option value="">–í—Å–µ</option>
                    <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>‚è≥ –û–∂–∏–¥–∞—é—Ç –≤—ã–ø—É—Å–∫–∞</option>
                    <option value="graduated" {% if status_filter == 'graduated' %}selected{% endif %}>üéì –í—ã–ø—É—â–µ–Ω—ã</option>
                    <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω—ã</option>
                </select>
            </div>
            
            <!-- –ì—Ä—É–ø–ø–∞ -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">–ì—Ä—É–ø–ø–∞</label>
                <select name="group" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}" {% if group_filter == group.id|stringformat:'s' %}selected{% endif %}>{{ group.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- –ö—É—Ä—Å -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">–ö—É—Ä—Å</label>
                <select name="course" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <option value="">–í—Å–µ –∫—É—Ä—Å—ã</option>
                    {% for course in courses %}
                    <option value="{{ course.id }}" {% if course_filter == course.id|stringformat:'s' %}selected{% endif %}>{{ course.title }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                –ü—Ä–∏–º–µ–Ω–∏—Ç—å
            </button>
            
            <a href="{% url 'backoffice:graduates_list' %}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                –°–±—Ä–æ—Å–∏—Ç—å
            </a>
        </form>
    </div>
</div>

<!-- –§–æ—Ä–º–∞ –º–∞—Å—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
<form method="post" action="{% url 'backoffice:graduates_bulk_action' %}" id="bulk-form">
    {% csrf_token %}
    
    <!-- –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    {% if graduates %}
    <div class="bg-white shadow rounded-lg mb-4">
        <div class="px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <label class="flex items-center">
                    <input type="checkbox" id="select-all" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <span class="ml-2 text-sm text-gray-600">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</span>
                </label>
                <span class="text-sm text-gray-500" id="selected-count">–í—ã–±—Ä–∞–Ω–æ: 0</span>
            </div>
            <div class="flex space-x-2">
                <button type="submit" name="action" value="approve" class="px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 disabled:opacity-50" id="btn-approve">
                    üéì –í—ã–ø—É—Å—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                </button>
                <button type="submit" name="action" value="reject" class="px-4 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 disabled:opacity-50" id="btn-reject">
                    ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                </button>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤ -->
    <div class="bg-white shadow overflow-hidden rounded-lg">
        <ul class="divide-y divide-gray-200">
            {% for graduate in graduates %}
            <li class="hover:bg-gray-50">
                <div class="px-4 py-4 sm:px-6 flex items-center">
                    <!-- –ß–µ–∫–±–æ–∫—Å -->
                    <div class="flex-shrink-0 mr-4">
                        <input type="checkbox" name="graduate_ids" value="{{ graduate.id }}" class="graduate-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    </div>
                    
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <a href="{% url 'backoffice:graduate_detail' graduate.id %}" class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-indigo-600 truncate">{{ graduate.user.get_full_name }}</p>
                                <p class="mt-1 text-xs text-gray-500">{{ graduate.user.email }} | –ò–ò–ù: {{ graduate.user.iin }}</p>
                                <p class="mt-1 text-xs text-gray-400">
                                    –ö—É—Ä—Å: {{ graduate.course.title }} | 
                                    –ì—Ä—É–ø–ø–∞: {{ graduate.group.name|default:'–ë–µ–∑ –≥—Ä—É–ø–ø—ã' }}
                                </p>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex flex-col items-end">
                                <!-- –°—Ç–∞—Ç—É—Å -->
                                {% if graduate.status == 'pending' %}
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    ‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø—É—Å–∫–∞
                                </span>
                                {% elif graduate.status == 'graduated' %}
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                    üéì –í—ã–ø—É—â–µ–Ω
                                </span>
                                {% elif graduate.status == 'rejected' %}
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                                    ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω
                                </span>
                                {% endif %}
                                
                                <!-- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç -->
                                <span class="mt-1 text-xs {% if graduate.certificate_file %}text-green-600{% else %}text-gray-400{% endif %}">
                                    {% if graduate.certificate_file %}üìú –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω{% else %}üìÑ –ù–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞{% endif %}
                                </span>
                                
                                <!-- –î–∞—Ç–∞ -->
                                <span class="mt-1 text-xs text-gray-400">
                                    –ó–∞–≤–µ—Ä—à–∏–ª: {{ graduate.completed_at|date:'d.m.Y' }}
                                </span>
                                
                                <!-- –û—Ü–µ–Ω–∫–∞ -->
                                <span class="mt-1 text-xs font-medium text-gray-600">
                                    –û—Ü–µ–Ω–∫–∞: {{ graduate.final_score|floatformat:0 }}%
                                </span>
                            </div>
                        </div>
                    </a>
                </div>
            </li>
            {% empty %}
            <li class="px-4 py-8 text-center text-gray-500">
                –ù–µ—Ç –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
            </li>
            {% endfor %}
        </ul>
    </div>
</form>

<script>
// –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
document.getElementById('select-all')?.addEventListener('change', function() {
    document.querySelectorAll('.graduate-checkbox').forEach(cb => cb.checked = this.checked);
    updateSelectedCount();
});

// –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
document.querySelectorAll('.graduate-checkbox').forEach(cb => {
    cb.addEventListener('change', updateSelectedCount);
});

function updateSelectedCount() {
    const count = document.querySelectorAll('.graduate-checkbox:checked').length;
    document.getElementById('selected-count').textContent = '–í—ã–±—Ä–∞–Ω–æ: ' + count;
}
</script>
{% endblock %}
